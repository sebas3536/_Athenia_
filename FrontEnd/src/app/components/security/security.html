<div class="container">
    <!-- Header -->
    <div>
        <h1 class="text-[#070025] mb-2 text-2xl font-bold">Seguridad</h1>
        <p class="text-gray-600 mb-6">Gestiona la seguridad de tu cuenta y protege tu información</p>
    </div>

    <!-- Security Status -->
    <!-- Security Status -->
    <section *ngIf="twoFactorEnabled"
        class="mb-6 p-6 border border-gray-200 rounded-xl bg-gradient-to-br from-green-50 to-white">
        <div class="flex items-start space-x-4">
            <div class="p-3 bg-green-500 rounded-full">
                <lucide-angular name="CheckCircle2" class="w-6 h-6 text-white"></lucide-angular>
            </div>
            <div class="flex-1">
                <h3 class="text-[#070025] mb-1 font-semibold">Cuenta Segura</h3>
                <p class="text-gray-600">Tu cuenta está protegida. Todas las medidas de seguridad están activas.</p>

            </div>
        </div>
    </section>

    <!-- Change Password -->
    <section class="border border-gray-200 rounded-xl overflow-hidden mb-6">
        <div class="p-6 border-b border-gray-200 bg-gray-50">
            <div class="flex items-center space-x-3">
                <div class="p-2 bg-[#02ab74] rounded-lg">
                    <lucide-angular name="Key" class="w-5 h-5 text-white"></lucide-angular>
                </div>
                <h2 class="text-[#070025] font-semibold">Cambiar Contraseña</h2>
            </div>
        </div>

        <div class="p-6">
            <form (ngSubmit)="handleChangePassword($event)" class="space-y-4 max-w-lg" autocomplete="off" novalidate>
                <!-- Contraseña actual -->
                <div class="space-y-2">
                    <label for="current-password" class="text-[#070025] text-sm font-medium">Contraseña Actual</label>
                    <input id="current-password" type="password" placeholder="••••••••" [(ngModel)]="currentPassword"
                        name="currentPassword" autocomplete="current-password"
                        class="w-full px-3 py-2.5 rounded-lg border border-gray-300 focus:border-[#02ab74] focus:ring-2 focus:ring-[#02ab74] focus:ring-offset-1 focus:outline-none transition-colors" />
                </div>

                <!-- Nueva contraseña -->
                <div class="space-y-2">
                    <label for="new-password" class="text-[#070025] text-sm font-medium">Nueva Contraseña</label>
                    <input id="new-password" type="password" placeholder="Mínimo 6 caracteres" [(ngModel)]="newPassword"
                        name="newPassword" autocomplete="new-password"
                        class="w-full px-3 py-2.5 rounded-lg border border-gray-300 focus:border-[#02ab74] focus:ring-2 focus:ring-[#02ab74] focus:ring-offset-1 focus:outline-none transition-colors" />
                </div>

                <!-- Confirmar nueva contraseña -->
                <div class="space-y-2">
                    <label for="confirm-password" class="text-[#070025] text-sm font-medium">Confirmar Nueva
                        Contraseña</label>
                    <input id="confirm-password" type="password" placeholder="Repite la nueva contraseña"
                        [(ngModel)]="confirmPassword" name="confirmPassword" autocomplete="new-password"
                        [class.border-red-300]="confirmPassword && !passwordsMatch"
                        [class.focus:border-red-500]="confirmPassword && !passwordsMatch"
                        [class.focus:ring-red-500]="confirmPassword && !passwordsMatch"
                        autocomplete="current-password"
                        class="w-full px-3 py-2.5 rounded-lg border border-gray-300 focus:border-[#02ab74] focus:ring-2 focus:ring-[#02ab74] focus:ring-offset-1 focus:outline-none transition-colors" />
                    <p *ngIf="confirmPassword && !passwordsMatch" class="text-sm text-red-500">
                        Las contraseñas no coinciden
                    </p>
                    <p *ngIf="passwordError" class="text-sm text-red-500">{{ passwordError }}</p>
                </div>

                <button type="submit" [disabled]="!isPasswordFormValid" [class.opacity-50]="!isPasswordFormValid"
                    [class.cursor-not-allowed]="!isPasswordFormValid"
                    class="px-4 py-2.5 bg-[#02ab74] hover:bg-[#028a5f] text-white rounded-lg font-medium transition-colors">
                    Actualizar Contraseña
                </button>
            </form>
        </div>
    </section>


    <!-- Two-Factor Authentication -->
    <section class="border border-gray-200 rounded-xl overflow-hidden mb-6">
        <div class="p-6 border-b border-gray-200 bg-gray-50">
            <div class="flex items-center space-x-3">
                <div class="p-2 bg-[#7209b7] rounded-lg">
                    <lucide-angular name="Smartphone" class="w-5 h-5 text-white"></lucide-angular>
                </div>
                <h2 class="text-[#070025] font-semibold">Autenticación de Dos Factores</h2>
            </div>
        </div>
        <div class="p-6">
            <div class="flex items-start justify-between mb-4">
                <div class="flex-1 pr-4">
                    <h3 class="text-[#070025] mb-2 font-medium">Verificación en Dos Pasos</h3>
                    <p class="text-gray-600 text-sm">
                        Agrega una capa adicional de seguridad a tu cuenta. Requiere un código de verificación
                        además de tu contraseña al iniciar sesión.
                    </p>
                </div>
                <div class="relative inline-flex items-center cursor-pointer">
                    <z-switch [(ngModel)]="twoFactorEnabled" (checkChange)="handleToggleTwoFactor($event)"></z-switch>
                </div>

            </div>

            <div *ngIf="twoFactorEnabled" class="mt-4 space-y-3">
                <div class="p-4 bg-green-50 rounded-lg border border-green-200">
                    <div class="flex items-start gap-3">
                        <lucide-angular name="CheckCircle2"
                            class="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0"></lucide-angular>
                        <div>
                            <h4 class="text-green-900 mb-1 font-medium">2FA Activo</h4>
                            <p class="text-sm text-green-800">Tu cuenta está protegida con autenticación de dos
                                factores.</p>
                        </div>
                    </div>
                </div>

                <div class="flex gap-3">
                    <button (click)="showSetupDialog = true"
                        class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2">
                        Ver códigos de respaldo
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Security Preferences -->
    <section class="border border-gray-200 rounded-xl overflow-hidden mb-6">
        <div class="p-6 border-b border-gray-200 bg-gray-50">
            <div class="flex items-center space-x-3">
                <div class="p-2 bg-blue-500 rounded-lg">
                    <lucide-angular name="Shield" class="w-5 h-5 text-white"></lucide-angular>
                </div>
                <h2 class="text-[#070025] font-semibold">Preferencias de Seguridad</h2>
            </div>
        </div>
        <div class="p-6 space-y-6">
            <div class="flex items-center justify-between">
                <div class="flex-1 pr-4">
                    <h3 class="text-[#070025] mb-1 font-medium">Notificaciones por Email</h3>
                    <p class="text-sm text-gray-600">Recibe alertas de seguridad por correo electrónico</p>
                </div>
                <div class="relative inline-flex items-center cursor-pointer">
                    <z-switch [(ngModel)]="emailNotifications"
                        (ngModelChange)="handleEmailNotificationsChange(emailNotifications)"></z-switch>
                </div>
            </div>

            <div class="flex items-center justify-between">
                <div class="flex-1 pr-4">
                    <h3 class="text-[#070025] mb-1 font-medium">Alertas de Inicio de Sesión</h3>
                    <p class="text-sm text-gray-600">Notificarte cuando se detecten nuevos inicios de sesión</p>
                </div>
                <div class="relative inline-flex items-center cursor-pointer">
                    <z-switch [(ngModel)]="loginAlerts"
                        (ngModelChange)="handleLoginAlertsChange(loginAlerts)"></z-switch>
                </div>

            </div>
        </div>
    </section>

    <!-- Active Sessions -->
    <section class="border border-gray-200 rounded-xl overflow-hidden">
        <div class="p-6 border-b border-gray-200 bg-gray-50">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="p-2 bg-orange-500 rounded-lg">
                        <lucide-angular name="AlertTriangle" class="w-5 h-5 text-white"></lucide-angular>
                    </div>
                    <h2 class="text-[#070025] font-semibold">Sesiones Activas</h2>
                </div>
                <button (click)="closeAllSessions()"
                    class="px-4 py-2 border border-red-200 text-red-600 hover:bg-red-50 rounded-lg transition-colors">
                    Cerrar Todas
                </button>
            </div>
        </div>
        <div class="divide-y divide-gray-200">
            <div *ngFor="let session of activeSessions" class="p-6 hover:bg-gray-50 transition-colors">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center space-x-2 mb-2">
                            <h3 class="text-[#070025] font-medium">{{ session.device }}</h3>
                            <span *ngIf="session.current"
                                class="px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full font-medium">
                                Sesión Actual
                            </span>
                        </div>
                        <p class="text-sm text-gray-600 mb-1">{{ session.location }}</p>
                        <p class="text-sm text-gray-500">{{ session.lastActive }}</p>
                    </div>
                    <button *ngIf="!session.current" (click)="closeSession(session.id)"
                        class="px-3 py-1.5 text-red-600 hover:bg-red-50 rounded-lg transition-colors text-sm">
                        Cerrar Sesión
                    </button>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- Two-Factor Setup Dialog -->
<app-two-factor-setup-dialog [open]="showSetupDialog" (openChange)="showSetupDialog = $event"
    (setupComplete)="handleSetupComplete()">
</app-two-factor-setup-dialog>